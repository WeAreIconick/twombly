@use "mixins" as *;

:root {
	--twombly--header-width: 300px;
	--twombly--hover-scale: scale(1.04);
	--twombly-card--border-radius: 16px;
	--twombly-card--padding: 20px;

	body:not(.admin-bar) {
		--wp-admin--admin-bar--height: 0;
	}
}

.is-style-twombly-card {
	box-sizing: border-box;
	background-color: var(--wp--preset--color--background);
	border: 1px solid var(--wp--preset--color--border);
	border-radius: var(--twombly-card--border-radius);
	padding: var(--twombly-card--padding) !important;

	> .wp-block-cover.alignfull:first-child,
	> .wp-block-post-featured-image:first-child {
		border: 1px solid var(--wp--preset--color--border);
		border-radius: var(--twombly-card--border-radius);
		overflow: hidden;

		margin-top: calc(-1 * var(--twombly-card--padding));
		margin-right: calc(-1 * var(--twombly-card--padding));
		margin-left: calc(-1 * var(--twombly-card--padding));
		border-bottom-left-radius: 0;
		border-bottom-right-radius: 0;
	}
}

// Layout Settings:
.wp-site-blocks {

	&.wp-site-blocks { // Doubling up to avoid `flow-root` changing the `display:` away from `grid`
		// Default styles (mobile-first)
		box-sizing: border-box;
		max-width: calc(1.5 * var(--wp--style--global--wide-size));
		margin: 0 auto;
		padding-left: var(--wp--style--root--padding-left, 0);
		padding-right: var(--wp--style--root--padding-right, 0);

		display: flex;
		flex-wrap: wrap;
		flex-direction: row;
		align-items: flex-start;
		gap: var(--wp--style--block-gap);
		
		// Desktop only: full viewport height
		@media ( min-width: calc($mobile-breakpoint + 1px) ) {
			min-height: calc(100vh - var(--wp-admin--admin-bar--height, 0));
		}

		> * {
			// Desktop only: width calculation with sidebar
			@media ( min-width: calc($mobile-breakpoint + 1px) ) {
				width: calc(100% - var(--twombly--header-width) - var(--wp--style--block-gap));
				margin-left: auto;
			}
		}

		> main > * {
			max-width: var(--wp--style--global--wide-size);
			margin-right: auto;
			margin-left: auto;
		}

		> .wp-block-template-part.header {
			align-self: start;
			box-sizing: border-box;
			flex-grow: 0;
			display: flex;
			flex-direction: column;
			z-index: 1;
			
			// Desktop only: sticky positioning and viewport height
			@media ( min-width: calc($mobile-breakpoint + 1px) ) {
				width: var(--twombly--header-width);
				position: sticky;
				top: calc(var(--wp--style--root--padding-top, 0) + var(--wp-admin--admin-bar--height, 0));
				min-height: calc(100vh - 2 * var(--wp--style--block-gap) - var(--wp-admin--admin-bar--height, 0));
				min-height: calc(100dvh - 2 * var(--wp--style--block-gap) - var(--wp-admin--admin-bar--height, 0));
				
				@at-root body:not(.admin-bar) #{&} {
					top: calc(var(--wp--style--root--padding-top, 0));
					min-height: calc(100vh - 2 * var(--wp--style--block-gap));
					min-height: calc(100dvh - 2 * var(--wp--style--block-gap));
				}
			}

			> .is-style-twombly-card {
				display: flex;
				flex-direction: column;
				
				// Desktop only: full height
				@media ( min-width: calc($mobile-breakpoint + 1px) ) {
					height: 100%;
					flex-grow: 1;
				}

				> footer {
					width: 100%;
				}
			}

			> .is-style-twombly-card {
				height: 100%;
				flex-grow: 1;

				display: flex;
				flex-direction: column;

				> footer {
					width: 100%;
				}
			}

			.wp-block-navigation {
				padding-right: 3rem;
				padding-left: 3rem;

				.wp-block-navigation__submenu-container {
					background-color: var(--wp--preset--color--background);
					border: 1px solid var(--wp--preset--color--border);

				}

				li {

					a,
					.wp-block-navigation-item__content,
					> button > svg {
						color: var(--wp--preset--color--text);
					}

					&:hover {

						> a,
						> .wp-block-navigation-item__content,
						> button > svg {
							color: var(--wp--preset--color--primary);
						}
					}
				}
			}

			.wp-block-separator {
				border-top-width: 1px;
				opacity: 0.5;
				margin: var(--wp--style--block-gap) 0;
			}
		}

		.wp-block-template-part.footer {
			box-sizing: border-box;
			margin-top: auto;
			padding-right: var(--wp--style--root--padding-right);
			padding-left: var(--wp--style--root--padding-left);

			> * {
				// --wp--style--global--content-size or --wp--style--global--wide-size
				max-width: var(--wp--style--global--content-size);
				margin-right: auto;
				margin-left: auto;
			}

			.wp-block-navigation .wp-block-navigation-item__content:hover {
				color: var(--wp--preset--color--primary);
			}
		}

		@media ( max-width: $mobile-breakpoint ) {
			flex-direction: column;

			> * {
				width: 100%;
			}

			> .wp-block-template-part.header {
				width: 100%;
				min-height: auto;
				position: static;

				> .is-style-twombly-card {
					background-color: transparent;
					border: none;
					padding: 0 !important;

					> .wp-block-group:first-child {


						.wp-block-navigation.is-responsive.is-layout-flex {
							flex-grow: 1;
							align-items: flex-end;
						}
					}

					footer {
						display: none;
					}
				}
			}

			.wp-block-navigation__responsive-container.has-modal-open.is-menu-open {
				background-color: var(--wp--preset--color--background);
				margin: auto;

				.wp-block-navigation__responsive-container-close svg {
					color: var(--wp--preset--color--text);
				}
			}
		}
	}
}

/* Link styling -- minimize specificity so can be overridden. */
:where(a) {
	transition: color 0.3s ease;

	&:hover {
		transition: color 0.1s ease;
	}
}

/* =============================================================================
   ACCESSIBILITY - SKIP TO CONTENT LINK
   ============================================================================= */

// Variables for easy customization
$skip-link-bg: #000;
$skip-link-color: #fff;
$skip-link-hover-bg: #333;
$skip-link-focus-color: #005fcc;
$skip-link-padding: 8px 16px;
$skip-link-padding-mobile: 12px 20px;
$skip-link-font-size: 14px;
$skip-link-font-size-mobile: 16px;
$skip-link-border-radius: 3px;
$skip-link-z-index: 100000;
$skip-link-transition: all 0.3s ease;

// Screen reader text variables
$sr-bg: #f1f1f1;
$sr-color: #21759b;
$sr-padding: 15px 23px 14px;

/**
 * Skip-to-content link for keyboard navigation
 * Hidden by default, visible when focused via keyboard (Tab key)
 */
.skip-link {
	position: absolute;
	top: -9999px;
	left: 6px;
	z-index: 999999;
	padding: $skip-link-padding;
	background-color: $skip-link-bg;
	color: $skip-link-color;
	text-decoration: none;
	font-size: $skip-link-font-size;
	font-weight: 600;
	line-height: 1.4;
	border-radius: $skip-link-border-radius;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
	transform: translateY(-100%);
	transition: $skip-link-transition;

	&:focus {
		position: absolute;
		top: 6px;
		left: 6px;
		clip: auto !important;
		clip-path: none;
		width: auto;
		height: auto;
		transform: translateY(0);
		z-index: $skip-link-z-index;
	}

	&:hover,
	&:focus {
		background-color: $skip-link-hover-bg;
		color: $skip-link-color;
		text-decoration: underline;
	}

	// Optional: Smooth focus indicator
	&:focus-visible {
		outline: 2px solid $skip-link-focus-color;
		outline-offset: 2px;
	}

	// Alternative high-contrast version
	@media (prefers-contrast: high) {
		background-color: $skip-link-bg;
		color: $skip-link-color;
		border: 2px solid $skip-link-color;
		
		&:hover,
		&:focus {
			background-color: $skip-link-color;
			color: $skip-link-bg;
			border-color: $skip-link-bg;
		}
	}

	// Responsive adjustments
	@media (max-width: 768px) {
		&:focus {
			font-size: $skip-link-font-size-mobile; // Prevents zoom on mobile
			padding: $skip-link-padding-mobile;
		}
	}
}

/**
 * Screen reader text utility class
 * Hides content visually while keeping it available to screen readers
 */
.screen-reader-text {
	border: 0;
	clip: rect(1px, 1px, 1px, 1px);
	clip-path: inset(50%);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute !important;
	width: 1px;
	word-wrap: normal !important;

	&:focus {
		background-color: $sr-bg;
		border-radius: $skip-link-border-radius;
		box-shadow: 0 0 2px 2px rgba(0, 0, 0, 0.6);
		clip: auto !important;
		clip-path: none;
		color: $sr-color;
		display: block;
		font-size: $skip-link-font-size;
		font-weight: bold;
		height: auto;
		left: 5px;
		line-height: normal;
		padding: $sr-padding;
		text-decoration: none;
		top: 5px;
		width: auto;
		z-index: $skip-link-z-index;
	}
}

// Mixins for reusable accessibility patterns
@mixin visually-hidden {
	border: 0;
	clip: rect(1px, 1px, 1px, 1px);
	clip-path: inset(50%);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute !important;
	width: 1px;
	word-wrap: normal !important;
}

@mixin visually-hidden-focusable {
	&:focus {
		clip: auto !important;
		clip-path: none;
		height: auto;
		width: auto;
		overflow: visible;
		position: static !important;
	}
}

// Helper classes using mixins
.visually-hidden {
	@include visually-hidden;
}

.visually-hidden-focusable {
	@include visually-hidden;
	@include visually-hidden-focusable;
}